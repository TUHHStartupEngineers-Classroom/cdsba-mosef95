{
  "hash": "83c1b4a1e34267ac261b96b622a04d5f",
  "result": {
    "markdown": "---\ntitle: \"Instrumental Variables\"\nauthor: \"Moritz Seefeldt\"\n---\n\n# Assignment 1\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-1_88da614a7e1dd32b58c3fb7d3f962f8a'}\n\n```{.r .cell-code}\ndf <- readRDS(\"data/rand_enc.rds\")\n\niv_rand_enc <- dagify(\n  Y ~ D,\n  Y ~ U,\n  D ~ U,\n  D ~ Z,\n  exposure = \"D\",\n  latent = \"U\",\n  outcome = \"Y\",\n  coords = list(x = c(U = 1, D = 0, Y = 2, Z = -1),\n                y = c(U = 1, D = 0, Y = 0, Z = 0)),\n  labels = c(\"D\" = \"Used new feature\", \n             \"Y\" = \"Time spent on app\", \n             \"U\" = \"Unobserved characteristics\",\n             \"Z\" = \"Random encouragement\")\n)\nggdag(iv_rand_enc, text = T) +\n  guides(color = \"none\") +\n  geom_dag_text(color = \"white\") +\n  geom_dag_edges(edge_color = \"white\") +\n  geom_dag_label_repel(aes(label = label))\n```\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n# Assignment 2\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-2_489b208e02572181cf6cc47ac429b998'}\n\n```{.r .cell-code}\nnaive_model <- lm(time_spent ~ used_ftr, data = df)\nsummary(naive_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = time_spent ~ used_ftr, data = df)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -20.4950  -3.5393   0.0158   3.5961  20.5051 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 18.86993    0.06955   271.3   <2e-16 ***\n#> used_ftr    10.82269    0.10888    99.4   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 5.351 on 9998 degrees of freedom\n#> Multiple R-squared:  0.497,\tAdjusted R-squared:  0.497 \n#> F-statistic:  9881 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n# Assignment 3\n\n## Stable unit treatment value assumption\nThe stable unit treatment value assumption is met, since the treatment for one user (usage of the new feature) does not affect the choices of another user.\n\n## Independence assumption\nSince the instrument (encouragement popup) is assigned to users randomly, it makes sense intuitively that there is no factor that influences both the instrument and the treatment (usage of new feature) or outcome (time spent on app).\n\n## Instrument relevance\nThe correlation of Z and D is checked using the \"first stage\":\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-3_5bf6b4d48eb4c4be661388fdaab61619'}\n\n```{.r .cell-code}\nfirst_stage <- lm(used_ftr ~ rand_enc, data = df)\nsummary(first_stage)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = used_ftr ~ rand_enc, data = df)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -0.5071 -0.3062 -0.3062  0.4929  0.6938 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 0.306164   0.006851   44.69   <2e-16 ***\n#> rand_enc    0.200940   0.009624   20.88   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 0.4811 on 9998 degrees of freedom\n#> Multiple R-squared:  0.04178,\tAdjusted R-squared:  0.04169 \n#> F-statistic:   436 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\nSince the p-value is very small, the instrument (encouragement) is highly significant.\n\n## Monotonicity assumption\nThe monotonicity assumption is checked using the given framework:\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-4_4ce95950525618172fbad3f4095baf97'}\n\n```{.r .cell-code}\nmonotonicity_check <- df %>%\n  mutate(observation_unit = case_when(\n    (rand_enc == 1 & used_ftr == 1) ~ \"Complier\",\n    (rand_enc == 1 & used_ftr == 0) ~ \"Defier\",\n    (rand_enc == 0 & used_ftr == 0) ~ \"Never taker\",\n    (rand_enc == 0 & used_ftr == 1) ~ \"Always taker\"\n  ))\n\n\ntable(monotonicity_check$observation_unit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Always taker     Complier       Defier  Never taker \n#>         1510         2570         2498         3422\n```\n:::\n:::\n\nThere is about the same number of compliers and defiers. This raises questions about the validity of the instrument. I would argue that the chosen instrument is not a very suitable estimation procedure for this application.\n\n# Assignment 4\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-5_dfaf7dd53062da4b71e56d50adb67b16'}\n\n```{.r .cell-code}\nmodel_iv <- iv_robust(time_spent ~ used_ftr | rand_enc, data = df)\nsummary(model_iv)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> iv_robust(formula = time_spent ~ used_ftr | rand_enc, data = df)\n#> \n#> Standard error type:  HC2 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value  Pr(>|t|) CI Lower CI Upper   DF\n#> (Intercept)   19.312     0.2248   85.89 0.000e+00   18.872    19.75 9998\n#> used_ftr       9.738     0.5353   18.19 8.716e-73    8.689    10.79 9998\n#> \n#> Multiple R-squared:  0.4921 ,\tAdjusted R-squared:  0.492 \n#> F-statistic:   331 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\nThe estimate using a naive model leads to a coefficient of 10,82, which has an upward bias compared to the estimate using the IV model (9,738)",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}