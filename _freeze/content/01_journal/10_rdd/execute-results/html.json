{
  "hash": "62a07921f7b1463f7d5e0b37c533a466",
  "result": {
    "markdown": "---\ntitle: \"Regression Discontinuity\"\nauthor: \"Moritz Seefeldt\"\n---\n\n\n# Assignment 1\n\n## Results with half the bandwidth\n\nAs can be observed from the code below, the results do not appear to be very sensitive to a reduction in the bandwidth. The local average treatment effect changes from 7.99 to 7.36, which is a small change considering the bandwidth was halved (a relative change of 8%). However, the slope of the average treatment effect appears to be steeper than before.\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-1_1250b0579e20c5d988960614a0420805'}\n\n```{.r .cell-code}\ndf <- readRDS(\"data/coupon.rds\")\n\nc0 <- 60\nbw <- c0 + c(-2.5, 2.5)\n\n# Subsets below and above threshold in specified bandwidth\ndf_bw_below <- df %>% filter(days_since_last >= bw[1] & days_since_last < c0)\ndf_bw_above <- df %>% filter(days_since_last >= c0 & days_since_last <= bw[2])\n\nmodel_bw_below <- lm(purchase_after ~ days_since_last, df_bw_below)\nmodel_bw_above <- lm(purchase_after ~ days_since_last, df_bw_above)\n\ny0 <- predict(model_bw_below, tibble(days_since_last = c0))\ny1 <- predict(model_bw_above, tibble(days_since_last = c0))\n\nlate <- y1 - y0\nsprintf(\"LATE: %.2f\", late)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"LATE: 7.36\"\n```\n:::\n\n```{.r .cell-code}\ndf_bw <- bind_rows(df_bw_above, df_bw_below)\nmin_y <- min(df_bw$purchase_after)\nmax_y <- max(df_bw$purchase_after)\n\n# Add lines for vertical distance and change limits of x-axis.\ndep_var_bw <- \n  ggplot(df_bw, aes(x = days_since_last, y = purchase_after, color = coupon)) +\n  geom_vline(xintercept = c0, color = \"blue\", linewidth = 2) +\n  geom_point(alpha = 0.4, size = 1) +\n  geom_smooth(data = df_bw_below, method = \"lm\", se = F, linewidth = 2) +\n  geom_smooth(data = df_bw_above, method = \"lm\", se = F, linewidth = 2) +\n  geom_segment(aes(x = c0, xend = bw[2], y = y0, yend = y0),\n               linetype = \"dotted\", color = \"red\") +\n  geom_segment(aes(x = bw[1], xend = c0, y = y1, yend = y1),\n               linetype = \"dotted\", color = \"red\") +\n  annotate(\"text\", x = c0+2, y = mean(c(y1, y0)-2),\n           label = sprintf(\"Difference: %.2f\", (y1 - y0)),\n           color = \"green\", fontface = 2) +\n  scale_y_continuous(limits = c(min_y, max_y)) + \n  scale_color_discrete(labels = c(\"No coupon\", \"Coupon\")) +\n  xlab(\"Days since last purchase\") +\n  ylab(\"Purchase after coupon assignment\") +\n  theme(legend.title = element_blank())\ndep_var_bw\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](10_rdd_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n## Results with twice the bandwidth\n\nDoubling the bandwidth increases the LATE by a factor of 1,19. The average treatment effect appears almost constant aside from the jump at the cut-off point.\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-2_4ea5f6e62a2b33b168749423df8e35d9'}\n\n```{.r .cell-code}\ndf <- readRDS(\"data/coupon.rds\")\n\nc0 <- 60\nbw <- c0 + c(-10, 10)\n\n# Subsets below and above threshold in specified bandwidth\ndf_bw_below <- df %>% filter(days_since_last >= bw[1] & days_since_last < c0)\ndf_bw_above <- df %>% filter(days_since_last >= c0 & days_since_last <= bw[2])\n\nmodel_bw_below <- lm(purchase_after ~ days_since_last, df_bw_below)\nmodel_bw_above <- lm(purchase_after ~ days_since_last, df_bw_above)\n\ny0 <- predict(model_bw_below, tibble(days_since_last = c0))\ny1 <- predict(model_bw_above, tibble(days_since_last = c0))\n\nlate <- y1 - y0\nsprintf(\"LATE: %.2f\", late)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"LATE: 9.51\"\n```\n:::\n\n```{.r .cell-code}\ndf_bw <- bind_rows(df_bw_above, df_bw_below)\nmin_y <- min(df_bw$purchase_after)\nmax_y <- max(df_bw$purchase_after)\n\n# Add lines for vertical distance and change limits of x-axis.\ndep_var_bw <- \n  ggplot(df_bw, aes(x = days_since_last, y = purchase_after, color = coupon)) +\n  geom_vline(xintercept = c0, color = \"blue\", linewidth = 2) +\n  geom_point(alpha = 0.4, size = 1) +\n  geom_smooth(data = df_bw_below, method = \"lm\", se = F, linewidth = 2) +\n  geom_smooth(data = df_bw_above, method = \"lm\", se = F, linewidth = 2) +\n  geom_segment(aes(x = c0, xend = bw[2], y = y0, yend = y0),\n               linetype = \"dotted\", color = \"red\") +\n  geom_segment(aes(x = bw[1], xend = c0, y = y1, yend = y1),\n               linetype = \"dotted\", color = \"red\") +\n  annotate(\"text\", x = c0+2, y = mean(c(y1, y0)-2),\n           label = sprintf(\"Difference: %.2f\", (y1 - y0)),\n           color = \"green\", fontface = 2) +\n  scale_y_continuous(limits = c(min_y, max_y)) + \n  scale_color_discrete(labels = c(\"No coupon\", \"Coupon\")) +\n  xlab(\"Days since last purchase\") +\n  ylab(\"Purchase after coupon assignment\") +\n  theme(legend.title = element_blank())\ndep_var_bw\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](10_rdd_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n# Assignment 2\nSince there is a noticable incline at the cut-off point, there appears to be non-random heaping. I would therefore argue that if the purchase amount were to be used as a running variable, the cut-off point should be chosen differently (e.g. at about 50€).\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-3_0fbbc0f0392a02632fb62157d79ec9af'}\n\n```{.r .cell-code}\ndf <- readRDS((\"data/shipping.rds\"))\n\nggplot(df, aes(x = purchase_amount)) +\n  geom_histogram(binwidth = 5, fill = \"blue\", color = \"black\") +\n  geom_vline(xintercept = 30, linetype = \"dashed\", color = \"red\", linewidth = 1) +\n  labs(title = \"Distribution of purchase amounts with cut-off at 30€\",\n       x = \"Purchase amount (€)\",\n       y = \"Frequency\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](10_rdd_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}